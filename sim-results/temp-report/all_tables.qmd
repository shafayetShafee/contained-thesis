---
title: "Simulation Tables"
author: Shafayet Khan Shafee
date: last-modified
date-format: "DD MMMM YYYY"
format: 
  pdf:
    classoption: titlepage
    keep-tex: true
    toc: true
    toccolor: blue
    geometry:
      - top=20mm
      - bottom=5mm
    include-in-header:
      text: |
        \usepackage{typearea}
---

\newpage

\KOMAoptions{usegeometry,paper=landscape,pagesize}
\recalctypearea
\newgeometry{right=10mm,left=10mm}


```{r}
#| echo: false
#| message: false
#| warning: false

library(dplyr)
library(kableExtra)

# Intercept model with high prevalence -----------------------------------------

final_res_int_high_prev <- readRDS(
  here::here("sim-results/rds/sim_res_two_lvl_int_high_prev.rds")
  )

mean_prevalence_int_high <- round(mean(final_res_int_high_prev$prevalence), 2)*100

# Intercept model with Low prevalence ------------------------------------------

final_res_int_low_prev <- readRDS(
  here::here("sim-results/rds/sim_res_two_lvl_int_low_prev.rds")
  )

mean_prevalence_int_low <- round(mean(final_res_int_low_prev$prevalence), 2)*100

# Slope model with High prevalence ---------------------------------------------

final_res_slp_high_prev <- readRDS(
  here::here("sim-results/rds/sim_res_two_lvl_slp_high_prev.rds")
  )

mean_prevalence_slp_high <- round(mean(final_res_slp_high_prev$prevalence), 2)*100

# Slope model with Low prevalence ----------------------------------------------

final_res_slp_low_prev <- readRDS(
  here::here("sim-results/rds/sim_res_two_lvl_slp_low_prev.rds")
  )

mean_prevalence_slp_low <- round(mean(final_res_slp_low_prev$prevalence), 2)*100
```


# Simulation Result Table for Intercept model with High Prevalence


```{r}
#| echo: false
sim_output_table_int_high <- final_res_int_high_prev %>% 
  arrange(cluster_number) %>% 
  mutate(ratio = se_mor_hat / sim_se_mor_hat) %>% 
  select(cluster_number, cluster_size, beta0_hat, beta1_hat, beta2_hat, 
         sigma_u_sq_hat, mor_hat, relative_bias, se_mor_hat, sim_se_mor_hat, 
         ratio, coverage, runs_used, runs_required)
```


```{r}
#| echo: false
kableExtra::kbl(sim_output_table_int_high, booktabs = TRUE, 
                digits = 2, linesep = "\\addlinespace[1.1ex]",
                align = paste0(rep('c', ncol(sim_output_table_int_high)),collapse = ""),
                col.names = c("Number of Cluster", "Cluster Size",
                            "$\\widehat{\\beta_0}$", "$\\widehat{\\beta_1}$", 
                            "$\\widehat{\\beta_2}$", "$\\widehat{\\sigma_u^2}$",
                            "$\\widehat{MOR}$", "Relative Bias (\\%)",
                            "$\\widehat{SE}_{MOR}$", 
                            "Simulation $\\widehat{SE}_{MOR}$", 
                            "Ratio\\textsuperscript{1}",
                            "CI coverage (95\\%)", "Runs used",
                            "Runs Required"), escape = FALSE) %>% 
  column_spec(1:ncol(sim_output_table_int_high), width = "1.4cm", latex_valign = "m") %>% 
  row_spec(
    seq(
      n_distinct(sim_output_table_int_high$cluster_number), 
      nrow(sim_output_table_int_high) - 1, 
      n_distinct(sim_output_table_int_high$cluster_size)), hline_after = TRUE
  ) %>% 
  footnote(
    general = paste0("The mean prevalence for this simulation is ", 
                     mean_prevalence_int_high, "\\\\%"),
    # threeparttable = TRUE,
    number = c("Ratio$\\\\;=\\\\;\\\\dfrac{\\\\widehat{SE}_{MOR}}{Simulation\\\\;\\\\widehat{SE}_{MOR}}$"), 
    symbol = c("True $MOR$ is 4.52",
               "True $\\\\sigma^2_u$ is 2.5",
               "True Values of $\\\\beta_0 = 2$, $\\\\beta_1 = 1.75$, $\\\\beta_2 = 0.67$"),
    escape = FALSE
  ) %>% 
  kable_styling(latex_options = c("HOLD_position", "scale_down"),
                font_size = 9)

```


# Simulation Result Table for Intercept model with Low Prevalence


```{r}
#| echo: false
sim_output_table_int_low <- final_res_int_low_prev %>% 
  arrange(cluster_number) %>% 
  mutate(ratio = se_mor_hat / sim_se_mor_hat) %>% 
  select(cluster_number, cluster_size, beta0_hat, beta1_hat, beta2_hat, 
         sigma_u_sq_hat, mor_hat, relative_bias, se_mor_hat, sim_se_mor_hat, 
         ratio, coverage, runs_used, runs_required)
```



```{r}
#| echo: false
kableExtra::kbl(sim_output_table_int_low, booktabs = TRUE, 
                digits = 2, linesep = "\\addlinespace[1.1ex]",
                align = paste0(rep('c', ncol(sim_output_table_int_low)),collapse = ""),
                col.names = c("Number of Cluster", "Cluster Size",
                            "$\\widehat{\\beta_0}$", "$\\widehat{\\beta_1}$", 
                            "$\\widehat{\\beta_2}$", "$\\widehat{\\sigma_u^2}$",
                            "$\\widehat{MOR}$", "Relative Bias (\\%)",
                            "$\\widehat{SE}_{MOR}$", 
                            "Simulation $\\widehat{SE}_{MOR}$", 
                            "Ratio\\textsuperscript{1}",
                            "CI coverage (95\\%)", "Runs used",
                            "Runs Required"), escape = FALSE) %>% 
  column_spec(1:ncol(sim_output_table_int_low), width = "1.4cm", latex_valign = "m") %>% 
  row_spec(
    seq(
      n_distinct(sim_output_table_int_low$cluster_number), 
      nrow(sim_output_table_int_low) - 1, 
      n_distinct(sim_output_table_int_low$cluster_size)), hline_after = TRUE
  ) %>% 
  footnote(
    general = paste0("The mean prevalence for this simulation is ", 
                     mean_prevalence_int_low, "\\\\%"),
    # threeparttable = TRUE,
    # footnote_as_chunk = TRUE,
    number = c("Ratio$\\\\;=\\\\;\\\\dfrac{\\\\widehat{SE}_{MOR}}{Simulation\\\\;\\\\widehat{SE}_{MOR}}$"), 
    symbol = c("True $MOR$ is 4.52",
               "True $\\\\sigma^2_u$ is 2.5",
               "True Values of $\\\\beta_0 = -2$, $\\\\beta_1 = 1.75$, $\\\\beta_2 = 0.67$"),
    escape = FALSE
  ) %>% 
  kable_styling(latex_options = "HOLD_position", 
                font_size = 9)

```


# Simulation Result Table for Slope model with High Prevalence


```{r}
#| echo: false
sim_output_table_slp_high <- final_res_slp_high_prev %>% 
  arrange(cluster_number) %>% 
  mutate(ratio = se_mor_hat / sim_se_mor_hat) %>% 
  select(cluster_number, cluster_size, beta0_hat, beta1_hat, beta2_hat, 
         sigma_u1_sq_hat, sigma_u2_sq_hat, sigma_u12_sq_hat,
         true_mor, mor_hat, relative_bias, se_mor_hat, sim_se_mor_hat, 
         ratio, coverage, runs_used, runs_required)
```




```{r}
#| echo: false
kableExtra::kbl(sim_output_table_slp_high, booktabs = TRUE, 
                digits = 2, linesep = "\\addlinespace[1.1ex]",
                align = paste0(rep('c', ncol(sim_output_table_slp_high)),collapse = ""),
                col.names = c("Number of Cluster", "Cluster Size",
                            "$\\widehat{\\beta_0}$", "$\\widehat{\\beta_1}$", 
                            "$\\widehat{\\beta_2}$", 
                            "$\\widehat{\\sigma_{u_1}^2}$", "$\\widehat{\\sigma_{u_2}^2}$",
                            "$\\widehat{\\sigma_{u_{12}}^2}$",
                            "$MOR$", "$\\widehat{MOR}$", "Relative Bias (\\%)",
                            "$\\widehat{SE}_{MOR}$", 
                            "Simulation $\\widehat{SE}_{MOR}$", 
                            "Ratio\\textsuperscript{1}",
                            "CI coverage (95\\%)", "Runs used",
                            "Runs Required"), escape = FALSE) %>% 
  column_spec(1:ncol(sim_output_table_slp_high), width = "1.1cm", latex_valign = "m") %>% 
  row_spec(
    seq(
      n_distinct(sim_output_table_slp_high$cluster_number), 
      nrow(sim_output_table_slp_high) - 1, 
      n_distinct(sim_output_table_slp_high$cluster_size)), hline_after = TRUE
  ) %>% 
  footnote(
    general = paste0("The mean prevalence for this simulation is ", mean_prevalence_slp_high, "\\\\%"),
    # threeparttable = TRUE,
    # footnote_as_chunk = TRUE,
    number = c("Ratio$\\\\;=\\\\;\\\\dfrac{\\\\widehat{SE}_{MOR}}{Simulation\\\\;\\\\widehat{SE}_{MOR}}$"), 
    symbol = c(
      "True $\\\\sigma^2_{u_1}$ = $1$, $\\\\sigma^2_{u_2}$ = $2$, $\\\\sigma^2_{u_{12}}$ = $0$ ",
      "True Values of $\\\\beta_0 = 2$, $\\\\beta_1 = 1.75$, $\\\\beta_2 = 0.67$"
      ),
    escape = FALSE
  ) %>% 
  kable_styling(latex_options = "HOLD_position",
                font_size = 8)

```



# Simulation Result Table for Slope model with Low Prevalence


```{r}
#| echo: false
sim_output_table_slp_low <- final_res_slp_low_prev %>% 
  arrange(cluster_number) %>% 
  mutate(ratio = se_mor_hat / sim_se_mor_hat) %>% 
  select(cluster_number, cluster_size, beta0_hat, beta1_hat, beta2_hat, 
         sigma_u1_sq_hat, sigma_u2_sq_hat, sigma_u12_sq_hat,
         true_mor, mor_hat, relative_bias, se_mor_hat, sim_se_mor_hat, 
         ratio, coverage, runs_used, runs_required)
```



```{r}
#| echo: false
kableExtra::kbl(sim_output_table_slp_low, booktabs = TRUE, 
                digits = 2, linesep = "\\addlinespace[1.1ex]",
                align = paste0(rep('c', ncol(sim_output_table_slp_low)),collapse = ""),
                col.names = c("Number of Cluster", "Cluster Size",
                            "$\\widehat{\\beta_0}$", "$\\widehat{\\beta_1}$", 
                            "$\\widehat{\\beta_2}$", 
                            "$\\widehat{\\sigma_{u_1}^2}$", "$\\widehat{\\sigma_{u_2}^2}$",
                            "$\\widehat{\\sigma_{u_{12}}^2}$",
                            "$MOR$", "$\\widehat{MOR}$", "Relative Bias (\\%)",
                            "$\\widehat{SE}_{MOR}$", 
                            "Simulation $\\widehat{SE}_{MOR}$", 
                            "Ratio\\textsuperscript{1}",
                            "CI coverage (95\\%)", "Runs used",
                            "Runs Required"), escape = FALSE) %>% 
  column_spec(1:ncol(sim_output_table_slp_low), width = "1.1cm", latex_valign = "m") %>% 
  row_spec(
    seq(
      n_distinct(sim_output_table_slp_low$cluster_number), 
      nrow(sim_output_table_slp_low) - 1, 
      n_distinct(sim_output_table_slp_low$cluster_size)), hline_after = TRUE
  ) %>% 
  footnote(
    general = paste0("The mean prevalence for this simulation is ", 
                     mean_prevalence_slp_low, "\\\\%"),
    # threeparttable = TRUE,
    # footnote_as_chunk = TRUE,
    number = c("Ratio$\\\\;=\\\\;\\\\dfrac{\\\\widehat{SE}_{MOR}}{Simulation\\\\;\\\\widehat{SE}_{MOR}}$"), 
    symbol = c(
      "True $\\\\sigma^2_{u_1}$ = $1$, $\\\\sigma^2_{u_2}$ = $2$, $\\\\sigma^2_{u_{12}}$ = $0$ ",
      "True Values of $\\\\beta_0 = -2$, $\\\\beta_1 = 1.75$, $\\\\beta_2 = 0.67$"
      ),
    escape = FALSE,
    fixed_small_size = TRUE
  ) %>% 
  kable_styling(latex_options = c("HOLD_position", "scale_down"), 
                font_size = 8)

```




